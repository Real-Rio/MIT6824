# MIT6824



## lab记录

### lab 1——mapreduce

> [实验文档](https://pdos.csail.mit.edu/6.824/labs/lab-mr.html)

**基本流程**

- worker会定期向coordinator发送rpc，询问自己当前需要做什么工作
- 在map阶段，coordinator将每个输入文件分配给一个worker，通知它进行map操作，每个worker完成之后发送rpc通知coordinator
- worker（map）对每个输入文件进行分词，每一个产生的k/v对根据hash值写入对应的中间文件中，命名规则为`mr-X-Y`，X是map任务编号，y是reduce任务编号
- coordinator需要能够检测所有map任务是否都已完成
- map都完成后，coordinator根据中间文件`mr-X-Y`中的"Y"，告诉reduce worker所有的map任务编号，reduce worker在共享磁盘上找到相应的文件调用reduce函数



**遇到的一些问题**

**rpc的时候网络中断处理**

1. coordinator会记录每个worker上次分配任务(map或reduce)的时间，如果超过10秒worker还没结束任务，coordinator认为worker断开连接，将任务分配给新的worker
2. worker使用rpc与coordinator建立连接的时候，如果通讯失败，最多可以重连3次

**worker工作到一半宕机怎么办**

worker先输出到一个临时文件，直到task结束时再原子地改名，防止其他worker读到写了一半就终止的文件